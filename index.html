<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>QR express | QR Generator</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%236366f1'><path d='M3 7V5a2 2 0 0 1 2-2h2'/><path d='M17 3h2a2 2 0 0 1 2 2v2'/><path d='M21 17v2a2 2 0 0 1-2 2h-2'/><path d='M7 21H5a2 2 0 0 1-2-2v-2'/><rect x='7' y='7' width='3' height='3' rx='1'/><rect x='14' y='7' width='3' height='3' rx='1'/><rect x='7' y='14' width='3' height='3' rx='1'/><path d='M14 17h3'/></svg>">
    
    <!-- Fonts: Plus Jakarta Sans & Inter (for iOS view) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- i18n: Language Router & Translations -->
    <script src="./js/i18n.js"></script>
    
    <!-- Library: qr-code-styling -->
    <script type="text/javascript" src="https://unpkg.com/qr-code-styling@1.5.0/lib/qr-code-styling.js"></script>

    <style>
        /* --- DESIGN VARIABLES --- */
        :root {
            /* Main App Vars */
            --primary: #6366f1;
            --primary-gradient: linear-gradient(135deg, #6366f1 0%, #a855f7 100%);
            --bg-color: #f3f4f6;
            --glass-bg: rgba(255, 255, 255, 0.75);
            --glass-border: rgba(255, 255, 255, 0.8);
            --text-main: #1e293b;
            --text-sub: #64748b;
            --input-bg: #f1f5f9;
            --border-focus: #818cf8;
            --shadow-lg: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1);

            /* iOS Animation Variables */
            --ios-blue: #007AFF;
            --ios-gray: #8E8E93;
            --spring-bounce: cubic-bezier(0.34, 1.56, 0.64, 1);
            --smooth-ease: cubic-bezier(0.25, 1, 0.5, 1);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Plus Jakarta Sans', sans-serif; -webkit-font-smoothing: antialiased; }

        body {
            background-color: var(--bg-color);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            overflow-x: hidden;
        }

        /* --- Animated Background --- */
        .ambient-bg {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1;
            background: radial-gradient(circle at 0% 0%, #e0e7ff 0%, transparent 50%), 
                        radial-gradient(circle at 100% 0%, #f3e8ff 0%, transparent 50%),
                        radial-gradient(circle at 100% 100%, #e0e7ff 0%, transparent 50%),
                        radial-gradient(circle at 0% 100%, #ffe4e6 0%, transparent 50%);
            filter: blur(40px);
            animation: pulseBg 10s ease-in-out infinite alternate;
        }
        @keyframes pulseBg { 0% { opacity: 0.8; transform: scale(1); } 100% { opacity: 1; transform: scale(1.05); } }

        /* --- Scrollbar --- */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }

        /* --- Header --- */
        .brand-header {
            width: 100%; max-width: 1200px; padding: 1.5rem 2rem;
            display: flex; align-items: center; justify-content: space-between; z-index: 10;
        }

        .brand-logo { display: flex; align-items: center; gap: 12px; }
        .logo-box {
            width: 36px; height: 36px;
            background: var(--primary-gradient);
            color: white; border-radius: 10px;
            display: flex; align-items: center; justify-content: center;
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.4);
        }
        .brand-text { font-size: 1.25rem; font-weight: 800; color: var(--text-main); letter-spacing: -0.02em; }

        .nav-items { display: flex; align-items: center; gap: 20px; }
        .nav-link { color: var(--text-sub); font-size: 0.9rem; font-weight: 600; text-decoration: none; transition: 0.2s; }
        .nav-link:hover { color: var(--primary); }

        /* Language Button */
        .lang-btn {
            background: white; border: 1px solid #e2e8f0; border-radius: 30px;
            padding: 6px 14px; display: flex; align-items: center; gap: 8px; cursor: pointer;
            font-size: 0.85rem; font-weight: 600; color: var(--text-main); transition: 0.2s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.02);
        }
        .lang-btn:hover { border-color: var(--primary); transform: translateY(-1px); }
        .lang-btn img, .lang-option img { 
            width: 20px; height: auto; 
            border-radius: 2px; 
            box-shadow: 0 1px 2px rgba(0,0,0,0.1); 
            border: 1px solid rgba(0,0,0,0.08); 
        }

        .lang-dropdown { position: relative; }
        
        .dropdown-menu {
            position: absolute; top: 125%; right: 0;
            background: white; border: 1px solid #f1f5f9; border-radius: 16px;
            box-shadow: 0 10px 30px -5px rgba(0,0,0,0.1); width: 160px;
            display: flex; flex-direction: column; padding: 6px; z-index: 100;
            opacity: 0; visibility: hidden; transform: translateY(10px);
            transition: opacity 0.3s ease, transform 0.3s cubic-bezier(0.16, 1, 0.3, 1), visibility 0.3s;
        }
        .dropdown-menu.show { opacity: 1; visibility: visible; transform: translateY(0); }
        
        .lang-option {
            padding: 10px; border-radius: 10px; display: flex; align-items: center; gap: 10px;
            text-decoration: none; color: var(--text-main); font-size: 0.85rem; font-weight: 600;
            transition: 0.2s;
        }
        .lang-option:hover { background: #f8fafc; color: var(--primary); }

        /* --- Main App Card --- */
        .app-container {
            width: 92%; max-width: 1100px;
            height: calc(100vh - 140px); min-height: 720px;
            background: var(--glass-bg);
            backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 32px;
            box-shadow: var(--shadow-lg);
            display: grid; grid-template-columns: 1fr 450px;
            overflow: hidden; position: relative; margin-bottom: 20px;
            animation: floatUp 0.6s cubic-bezier(0.16, 1, 0.3, 1);
        }

        /* Left Column: Controls */
        .controls-panel {
            padding: 2.5rem; overflow-y: auto; display: flex; flex-direction: column;
            border-right: 1px solid rgba(0,0,0,0.05);
        }

        /* Tabs Grid */
        .tabs-grid {
            display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; margin-bottom: 2rem;
        }
        .tab-btn {
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            gap: 8px; padding: 14px 8px; border: 1px solid transparent; background: rgba(255,255,255,0.6);
            color: var(--text-sub); font-size: 0.75rem; font-weight: 700; cursor: pointer;
            border-radius: 16px; transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .tab-btn:hover { transform: translateY(-3px); background: white; box-shadow: 0 4px 12px rgba(0,0,0,0.05); color: var(--primary); }
        .tab-btn.active {
            background: white; border-color: var(--primary); color: var(--primary);
            box-shadow: 0 4px 15px rgba(99, 102, 241, 0.15);
            animation: tabPop 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        @keyframes tabPop { 0% { transform: scale(0.95); } 50% { transform: scale(1.02); } 100% { transform: scale(1); } }
        
        .tab-btn svg { width: 22px; height: 22px; stroke-width: 2; transition: 0.2s; }

        /* Forms & Inputs */
        .form-group { display: none; animation: fadeIn 0.3s ease; }
        .form-group.active { display: block; }
        
        label { display: flex; align-items: center; font-size: 0.8rem; font-weight: 700; color: var(--text-main); margin-bottom: 0.5rem; text-transform: uppercase; letter-spacing: 0.03em; }
        
        input, select, textarea {
            width: 100%; padding: 0.9rem 1rem; 
            border: 2px solid transparent; border-radius: 12px;
            font-size: 0.95rem; font-weight: 500; outline: none; 
            background: var(--input-bg); color: var(--text-main);
            transition: all 0.3s cubic-bezier(0.25, 1, 0.5, 1);
        }
        input:focus, select:focus, textarea:focus {
            background: white; border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1);
            transform: translateY(-1px);
        }
        input::placeholder, textarea::placeholder { color: #94a3b8; }
        textarea { resize: vertical; min-height: 100px; line-height: 1.5; }
        .row-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }

        /* Tooltips */
        .tooltip-wrapper { position: relative; display: inline-flex; margin-left: 8px; text-transform: none; letter-spacing: normal; }
        .tooltip-icon {
            width: 16px; height: 16px; border-radius: 50%; background: #cbd5e1; color: white;
            font-size: 10px; font-weight: 700; display: flex; align-items: center; justify-content: center;
            cursor: help; transition: 0.2s;
        }
        .tooltip-icon:hover { background: var(--primary); }
        .tooltip-content {
            visibility: hidden; opacity: 0; position: absolute; bottom: 140%; left: 50%; transform: translateX(-50%) translateY(5px);
            background: var(--text-main); color: white; padding: 8px 12px; border-radius: 8px; font-size: 11px; font-weight: 500;
            width: 180px; text-align: center; z-index: 100; transition: all 0.2s cubic-bezier(0.16, 1, 0.3, 1);
            box-shadow: 0 10px 20px rgba(0,0,0,0.15); line-height: 1.4; pointer-events: none;
        }
        .tooltip-content::after {
            content: ""; position: absolute; top: 100%; left: 50%; margin-left: -5px;
            border-width: 5px; border-style: solid; border-color: var(--text-main) transparent transparent transparent;
        }
        .tooltip-wrapper:hover .tooltip-content { visibility: visible; opacity: 1; transform: translateX(-50%) translateY(0); }


        /* --- DESIGN ACCORDION --- */
        .design-section { margin-top: 2.5rem; border-top: 1px solid #e2e8f0; padding-top: 1.5rem; }
        
        .design-toggle {
            display: flex; justify-content: space-between; align-items: center; width: 100%; 
            background: white; border: 1px solid #e2e8f0; padding: 1.2rem; border-radius: 16px;
            cursor: pointer; font-weight: 700; color: var(--text-main); transition: all 0.2s;
            box-shadow: 0 2px 5px rgba(0,0,0,0.02);
        }
        .design-toggle:hover { border-color: var(--primary); color: var(--primary); transform: translateY(-1px); box-shadow: 0 4px 12px rgba(0,0,0,0.05); }
        
        .toggle-text-btn {
            font-size: 0.8rem; font-weight: 700; color: var(--primary); 
            background: rgba(99, 102, 241, 0.1); padding: 6px 12px; border-radius: 20px;
            transition: all 0.2s;
        }
        .design-toggle:hover .toggle-text-btn { background: var(--primary); color: white; }

        .design-options-wrapper {
            display: grid;
            grid-template-rows: 0fr;
            transition: grid-template-rows 0.5s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.4s ease, margin-top 0.4s ease;
            opacity: 0.5;
            margin-top: 0;
        }
        .design-options-wrapper.open {
            grid-template-rows: 1fr;
            opacity: 1;
            margin-top: 1rem;
        }
        .design-options-inner {
            overflow: hidden;
            padding-top: 0.5rem;
        }
        
        .design-grid {
            display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem;
        }
        .full-width { grid-column: span 2; }

        .color-bubbles-container {
            display: flex; gap: 10px; flex-wrap: wrap; align-items: center;
        }
        .color-bubble {
            width: 38px; height: 38px; border-radius: 50%; cursor: pointer;
            border: 2px solid white; box-shadow: 0 2px 6px rgba(0,0,0,0.1);
            transition: transform 0.2s cubic-bezier(0.34, 1.56, 0.64, 1);
            position: relative;
        }
        .color-bubble:hover { transform: scale(1.15); z-index: 2; }
        .color-bubble.active { box-shadow: 0 0 0 2px white, 0 0 0 4px var(--primary); transform: scale(1.1); }
        
        .custom-picker-wrapper {
            width: 38px; height: 38px; border-radius: 50%; background: #f1f5f9;
            display: flex; align-items: center; justify-content: center;
            border: 1px dashed #cbd5e1; cursor: pointer; position: relative; overflow: hidden;
            color: var(--text-sub); transition: 0.2s;
        }
        .custom-picker-wrapper:hover { border-color: var(--primary); color: var(--primary); background: white; }
        .custom-picker-input {
            position: absolute; width: 200%; height: 200%; top: -50%; left: -50%; 
            opacity: 0; cursor: pointer;
        }

        .file-upload {
            border: 2px dashed #cbd5e1; padding: 1.5rem; text-align: center; border-radius: 12px;
            cursor: pointer; font-size: 0.85rem; color: var(--text-sub); transition: 0.2s; background: #f8fafc;
            position: relative;
        }
        .file-upload:hover { border-color: var(--primary); background: #eef2ff; color: var(--primary); }
        
        .btn-remove-logo {
            margin-top: 10px;
            background: #fee2e2; color: #ef4444; border: none; padding: 6px 12px; border-radius: 8px;
            font-size: 0.75rem; font-weight: 700; cursor: pointer; display: none; /* Hidden by default */
            align-items: center; gap: 5px; margin-left: auto; margin-right: auto;
            transition: 0.2s;
        }
        .btn-remove-logo:hover { background: #fecaca; transform: scale(1.05); }

        /* --- RIGHT COLUMN: PREVIEW & SIMULATOR --- */
        .preview-panel {
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            padding: 2.5rem; position: relative; overflow: hidden;
        }
        .preview-bg-pattern {
            position: absolute; inset: 0; opacity: 0.4; pointer-events: none;
            background-image: linear-gradient(#cbd5e1 1px, transparent 1px), linear-gradient(90deg, #cbd5e1 1px, transparent 1px);
            background-size: 30px 30px;
        }

        /* FEATURE 3: Scannability Widget */
        .scannability-widget {
            margin-bottom: 20px; z-index: 5; background: white;
            padding: 8px 16px; border-radius: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            display: flex; align-items: center; gap: 10px; width: 100%; max-width: 280px;
        }
        .score-circle {
            width: 32px; height: 32px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-size: 0.7rem; font-weight: 800; color: white;
            transition: 0.3s;
        }
        .score-info { display: flex; flex-direction: column; flex: 1; }
        .score-title { font-size: 0.7rem; font-weight: 700; color: var(--text-sub); text-transform: uppercase; }
        .score-val { font-size: 0.85rem; font-weight: 800; color: var(--text-main); }
        .score-dot { width: 8px; height: 8px; border-radius: 50%; background: #ccc; }

        /* 1. Static Preview Container (Default) */
        #static-preview-container {
            display: flex; flex-direction: column; align-items: center; z-index: 2; transition: 0.3s; width: 100%;
        }

        #qr-canvas {
            background: white; padding: 25px; border-radius: 24px;
            box-shadow: 0 20px 50px -12px rgba(0,0,0,0.15); margin-bottom: 2.5rem;
            transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            position: relative; z-index: 2;
        }
        #qr-canvas:hover { transform: scale(1.02) translateY(-5px); box-shadow: 0 25px 60px -12px rgba(99, 102, 241, 0.25); }
        
        @keyframes canvasPulse { 0% { transform: scale(1); } 50% { transform: scale(0.98); opacity: 0.8; } 100% { transform: scale(1); opacity: 1; } }
        .canvas-pulse { animation: canvasPulse 0.3s ease-in-out; }

        /* FEATURE 4: Premium Buttons (No Icons) */
        .btn-group { display: flex; flex-direction: column; gap: 12px; width: 100%; max-width: 280px; position: relative; z-index: 2; }

        .premium-btn {
            width: 100%; padding: 1.1rem;
            border-radius: 12px; font-weight: 700; font-size: 0.9rem; cursor: pointer;
            letter-spacing: 0.02em; text-align: center;
            transition: all 0.3s cubic-bezier(0.25, 1, 0.5, 1);
            position: relative; overflow: hidden;
            display: flex; justify-content: center; align-items: center;
        }

        .btn-primary-pro {
            background: #111827; color: white; border: 1px solid transparent;
            box-shadow: 0 10px 30px -10px rgba(0,0,0,0.3);
        }
        .btn-primary-pro:hover { 
            background: #000; transform: translateY(-2px); 
            box-shadow: 0 15px 35px -10px rgba(0,0,0,0.4);
        }
        .btn-primary-pro::after {
            content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(rgba(255,255,255,0.1), transparent);
            opacity: 0; transition: opacity 0.3s;
        }
        .btn-primary-pro:hover::after { opacity: 1; }

        .btn-secondary-pro {
            background: rgba(255, 255, 255, 0.8); color: var(--text-main);
            border: 1px solid rgba(0,0,0,0.08);
            backdrop-filter: blur(10px);
        }
        .btn-secondary-pro:hover {
            background: white; border-color: var(--primary); color: var(--primary);
            box-shadow: 0 5px 15px -5px rgba(99, 102, 241, 0.2);
        }

        /* 2. Animated Simulator (Hidden by Default) */
        #anim-preview-container {
            display: none; /* Hidden by default */
            flex-direction: column; align-items: center; z-index: 5;
            animation: fadeIn 0.4s ease;
        }

        .iphone-frame {
            width: 300px;
            height: 600px;
            background: #000;
            border-radius: 45px;
            position: relative;
            box-shadow: 0 0 0 6px #3a3a3a, 0 0 0 8px #1a1a1a, 0 40px 80px -20px rgba(0,0,0,0.5);
            overflow: hidden;
            font-family: 'Inter', sans-serif; /* iOS Font */
        }

        .dynamic-island {
            position: absolute; top: 18px; left: 50%; transform: translateX(-50%);
            width: 100px; height: 30px; background: #000; border-radius: 20px; z-index: 100;
            transition: width 0.4s var(--spring-bounce), height 0.4s var(--spring-bounce);
        }
        .dynamic-island.show-success { width: 140px; }

        .camera-screen {
            width: 100%; height: 100%; background: #121212; position: relative;
            display: flex; flex-direction: column;
        }

        .status-bar { height: 50px; display: flex; justify-content: space-between; padding: 15px 25px; color: white; font-size: 12px; font-weight: 600; z-index: 50; }

        .viewfinder-area {
            flex: 1; position: relative; display: flex; justify-content: center; align-items: center; overflow: hidden;
        }
        .camera-bg { position: absolute; inset: 0; background: radial-gradient(circle at center, #2c2c2e 0%, #000 90%); }

        .qr-target {
            width: 160px; height: 160px; background: white; padding: 8px; border-radius: 12px;
            position: relative; z-index: 5; transform: scale(1);
            filter: blur(8px) brightness(0.7); 
            transition: filter 0.2s ease-out, transform 0.5s var(--spring-bounce);
        }
        .qr-target img { width: 100%; height: 100%; display: block; }
        
        .iphone-frame.scanning .qr-target { filter: blur(0px) brightness(1); transform: scale(1.05); }

        /* Corners & Beam */
        .focus-corners { position: absolute; width: 200px; height: 200px; z-index: 6; pointer-events: none; opacity: 0.6; }
        .corner {
            position: absolute; width: 30px; height: 30px; border-color: #ffd60a; border-style: solid; border-width: 3px; border-radius: 4px; opacity: 0; transition: opacity 0.3s;
        }
        .tl { top: 0; left: 0; border-right: 0; border-bottom: 0; border-radius: 12px 0 0 0; }
        .tr { top: 0; right: 0; border-left: 0; border-bottom: 0; border-radius: 0 12px 0 0; }
        .bl { bottom: 0; left: 0; border-right: 0; border-top: 0; border-radius: 0 0 0 12px; }
        .br { bottom: 0; right: 0; border-left: 0; border-top: 0; border-radius: 0 0 12px 0; }
        .iphone-frame.scanning .corner { opacity: 1; }

        /* UPDATED: Full Range Scan Beam */
        .scan-beam {
            position: absolute; top: 50%; left: 0; right: 0; height: 4px; background: #ffd60a;
            box-shadow: 0 0 40px 10px rgba(255,214,10,0.5); z-index: 7; transform: scaleX(0); opacity: 0;
            margin-top: -2px; /* Center alignment correction */
        }
        .iphone-frame.scanning .scan-beam { animation: scanLock 1.8s ease-in-out forwards; }

        @keyframes scanLock {
            0% { transform: translateY(-140px) scaleX(1); opacity: 0; }
            10% { opacity: 1; }
            50% { box-shadow: 0 0 50px 20px rgba(255,214,10,0.8); }
            90% { transform: translateY(140px) scaleX(1); opacity: 1; }
            100% { transform: translateY(140px) scaleX(1); opacity: 0; }
        }

        /* Bottom Sheet */
        .bottom-sheet {
            position: absolute; left: 10px; right: 10px; bottom: 0;
            background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(25px) saturate(180%);
            border-radius: 20px; padding: 20px;
            transform: translateY(110%); transition: transform 0.6s var(--spring-bounce);
            z-index: 50; text-align: center; display: flex; flex-direction: column; align-items: center;
        }
        .bottom-sheet.visible { transform: translateY(-15px); }
        .sheet-pill { width: 36px; height: 5px; background: #C6C6C8; border-radius: 10px; margin-bottom: 15px; }
        
        .sheet-icon {
            width: 50px; height: 50px; background: #F2F2F7; border-radius: 12px;
            display: flex; align-items: center; justify-content: center; margin-bottom: 10px; color: var(--ios-blue);
            margin-left: auto; margin-right: auto;
        }
        /* Simplified text structure for sheet */
        .sheet-desc { font-size: 14px; color: var(--text-main); margin-bottom: 15px; line-height: 1.4; max-width: 90%; word-break: break-all; }

        /* Fake IOS Buttons */
        .sheet-actions { width: 100%; display: flex; flex-direction: column; gap: 8px; }
        .ios-action-btn {
            width: 100%; padding: 12px; border-radius: 12px; border: none; font-size: 15px; font-weight: 600;
            cursor: default !important; display: flex; justify-content: center; align-items: center; gap: 8px; opacity: 0.8;
        }
        .ios-action-btn.primary { background: #E5E5EA; color: var(--ios-blue); }
        .ios-action-btn.secondary { background: transparent; color: var(--ios-blue); }

        .btn-close-sim {
            margin-top: 15px; background: #fee2e2; color: #ef4444; border: none; padding: 10px 20px; border-radius: 20px; font-weight: 600; cursor: pointer; transition: 0.2s;
        }
        .btn-close-sim:hover { background: #fecaca; }

        /* --- MODAL STYLES --- */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(15, 23, 42, 0.6); backdrop-filter: blur(8px); z-index: 1000;
            display: none; justify-content: center; align-items: center; opacity: 0; transition: opacity 0.3s;
        }
        .modal-overlay.show { display: flex; opacity: 1; }
        
        .modal-content {
            background: white; width: 92%; max-width: 850px;
            padding: 2.5rem; border-radius: 28px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25); 
            transform: scale(0.9); transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            text-align: left; position: relative; max-height: 95vh; overflow-y: auto;
        }
        .modal-overlay.show .modal-content { transform: scale(1); }
        
        .modal-header { text-align: center; margin-bottom: 2rem; }
        .modal-title { font-size: 1.5rem; font-weight: 800; color: var(--text-main); margin-bottom: 0.5rem; }
        .modal-subtitle { font-size: 0.95rem; color: var(--text-sub); }
        
        .modal-close-icon { position: absolute; top: 1.5rem; right: 1.5rem; cursor: pointer; color: var(--text-sub); background: none; border: none; transition: 0.2s; z-index: 10; }
        .modal-close-icon:hover { color: var(--text-main); }

        .modal-layout { display: grid; grid-template-columns: 1fr 1fr; gap: 2.5rem; align-items: start; }

        .modal-preview-container {
            width: 100%; display: flex; justify-content: center; align-items: center;
            background: #f8fafc; border-radius: 20px; padding: 2rem;
            border: 1px solid #e2e8f0; height: 100%; min-height: 300px;
        }
        #previewCanvas {
            max-width: 100%; height: auto; 
            box-shadow: 0 10px 30px -5px rgba(0,0,0,0.1); border-radius: 12px;
            background: white;
        }

        .modal-controls { display: flex; flex-direction: column; gap: 1.5rem; }

        .template-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; }
        .template-card {
            border: 2px solid transparent; border-radius: 12px; padding: 10px 8px; text-align: center;
            cursor: pointer; transition: all 0.2s; background: #f8fafc;
        }
        .template-card:hover { border-color: var(--primary); background: #eef2ff; transform: translateY(-2px); }
        .template-card.selected { border-color: var(--primary); background: #e0e7ff; box-shadow: 0 4px 12px rgba(99, 102, 241, 0.15); }
        
        .template-preview-icon { height: 35px; border-radius: 6px; margin-bottom: 8px; position: relative; overflow: hidden; margin-left: auto; margin-right: auto; width: 60%; }
        
        .tp-plain { background: #cbd5e1; }
        .tp-scan { background: #cbd5e1; border-bottom: 8px solid var(--text-main); }
        .tp-wifi { background: #cbd5e1; border: 2px solid var(--primary); }
        .tp-biz { background: #cbd5e1; border: 2px solid #10b981; }
        .tp-sms { background: #cbd5e1; border: 2px dashed #ef4444; }
        
        /* New Template Styles */
        .tp-social { background: #cbd5e1; border: 2px solid #8b5cf6; }
        .tp-product { background: #cbd5e1; border: 2px solid #3b82f6; }
        .tp-event { background: #cbd5e1; border: 2px solid #f97316; }

        .template-name { font-size: 0.75rem; font-weight: 700; color: var(--text-main); }

        .btn-confirm { width: 100%; background: var(--text-main); color: white; padding: 1rem; border-radius: 12px; border: none; font-weight: 700; cursor: pointer; transition: 0.2s; font-size: 1rem; }
        .btn-confirm:hover { background: black; transform: translateY(-2px); box-shadow: 0 10px 20px -5px rgba(0,0,0,0.2); }
        
        /* FEATURE 1: SVG Button Style */
        .btn-svg { 
            width: 100%; background: transparent; color: var(--text-main); padding: 0.8rem; 
            border: 2px solid #e2e8f0; border-radius: 12px; font-weight: 700; cursor: pointer; 
            transition: 0.2s; font-size: 0.9rem; margin-top: 10px;
        }
        .btn-svg:hover { border-color: var(--text-main); background: #f8fafc; }

        .footer-text { font-size: 0.8rem; color: var(--text-sub); margin: 1rem 0; font-weight: 600; }

        /* Responsive */
        @media (max-width: 900px) {
            .app-container { grid-template-columns: 1fr; height: auto; min-height: auto; border-radius: 24px; overflow: visible; }
            body { padding: 1rem; height: auto; }
            .brand-header { flex-direction: column; gap: 1rem; text-align: center; }
            .preview-panel { padding: 3rem 1rem; border-top: 1px solid #e2e8f0; order: -1; border-radius: 24px 24px 0 0; }
            .controls-panel { border-radius: 0 0 24px 24px; }
            #qr-canvas { width: 240px; height: 240px; padding: 15px; }
            #qr-canvas canvas { width: 100% !important; height: auto !important; }
        }

        /* Modal specific responsive */
        @media (max-width: 768px) {
            .modal-content { padding: 1.5rem; width: 95%; }
            .modal-layout { grid-template-columns: 1fr; gap: 1.5rem; }
            .modal-header { margin-bottom: 1rem; }
        }

        @media (max-width: 500px) { .tabs-grid { grid-template-columns: repeat(2, 1fr); } }
        
        /* Animations */
        @keyframes floatUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body>

    <div class="ambient-bg"></div>

    <!-- Header -->
    <header class="brand-header">
        <div class="brand-logo">
            <div class="logo-box">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M3 7V5a2 2 0 0 1 2-2h2"/><path d="M17 3h2a2 2 0 0 1 2 2v2"/><path d="M21 17v2a2 2 0 0 1-2 2h-2"/><path d="M7 21H5a2 2 0 0 1-2-2v-2"/><rect x="7" y="7" width="3" height="3" rx="1"/><rect x="14" y="7" width="3" height="3" rx="1"/><rect x="7" y="14" width="3" height="3" rx="1"/><path d="M14 17h3"/></svg>
            </div>
            <div class="brand-text">QR express</div>
        </div>

        <div class="nav-items">
            <div class="lang-dropdown">
                <button class="lang-btn" onclick="toggleLangMenu(event)">
                    <img id="currentFlag" src="https://flagcdn.com/w40/gb.png" style="border-radius:2px" alt="English">
                    <span id="currentCode">EN</span>
                </button>
                <div class="dropdown-menu" id="langMenu">
                    <a href="#" class="lang-option" onclick="selectLang('gb', 'EN')"><img src="https://flagcdn.com/w40/gb.png"> English</a>
                    <a href="#" class="lang-option" onclick="selectLang('ro', 'RO')"><img src="https://flagcdn.com/w40/ro.png"> Română</a>
                    <a href="#" class="lang-option" onclick="selectLang('it', 'IT')"><img src="https://flagcdn.com/w40/it.png"> Italiano</a>
                    <a href="#" class="lang-option" onclick="selectLang('ru', 'RU')"><img src="https://flagcdn.com/w40/ru.png"> Русский</a>
                    <a href="#" class="lang-option" onclick="selectLang('ua', 'UA')"><img src="https://flagcdn.com/w40/ua.png"> Українська</a>
                </div>
            </div>
        </div>
    </header>

    <div class="app-container">
        <!-- Left: Controls -->
        <div class="controls-panel">
            
            <!-- Grid Tabs -->
            <div class="tabs-grid">
                <button class="tab-btn active" onclick="switchTab('link')" data-i18n="link">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1" /></svg>
                    Link
                </button>
                <button class="tab-btn" onclick="switchTab('wifi')" data-i18n="wifi">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M8.111 16.404a5.5 5.5 0 017.778 0M12 20h.01m-7.08-7.071c3.904-3.905 10.236-3.905 14.141 0M1.394 9.393c5.857-5.857 15.355-5.857 21.213 0" /></svg>
                    WiFi
                </button>
                <button class="tab-btn" onclick="switchTab('email')" data-i18n="email">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" /></svg>
                    Email
                </button>
                <button class="tab-btn" onclick="switchTab('phone')" data-i18n="phone">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" /></svg>
                    Phone
                </button>
                <button class="tab-btn" onclick="switchTab('sms')" data-i18n="sms">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z" /></svg>
                    SMS
                </button>
                <button class="tab-btn" onclick="switchTab('geo')" data-i18n="loc">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" /><path stroke-linecap="round" stroke-linejoin="round" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" /></svg>
                    Loc
                </button>
                <button class="tab-btn" onclick="switchTab('vcard')" data-i18n="contact_tab">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M10 6H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V8a2 2 0 00-2-2h-5m-4 0V5a2 2 0 114 0v1m-4 0a2 2 0 104 0m-5 8a2 2 0 100-4 2 2 0 000 4zm0 0c1.306 0 2.417.835 2.83 2M9 14a3.001 3.001 0 00-2.83 2M15 11h3m-3 4h2" /></svg>
                    Contact
                </button>
                <button class="tab-btn" onclick="switchTab('text')" data-i18n="text">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" /></svg>
                    Text
                </button>
            </div>

            <!-- FORMS -->
            <div id="form-link" class="form-group active">
                <label data-i18n="website_url">Website URL</label>
                <input type="url" id="urlInput" placeholder="https://example.com" oninput="updateQR()">
            </div>

            <div id="form-wifi" class="form-group">
                <label data-i18n="network_ssid">Network SSID <div class="tooltip-wrapper"><span class="tooltip-icon">?</span><div class="tooltip-content" data-i18n="ssid_tooltip">Exact WiFi name</div></div></label>
                <input type="text" id="ssidInput" placeholder="WiFi Name" oninput="updateQR()">
                <div class="row-2" style="margin-top:15px">
                    <div><label data-i18n="password">Password</label><input type="text" id="passInput" placeholder="Password" oninput="updateQR()"></div>
                    <div><label data-i18n="encryption">Encryption</label><select id="encInput" onchange="updateQR()"><option value="WPA">WPA/WPA2</option><option value="WEP">WEP</option><option value="nopass">None</option></select></div>
                </div>
            </div>

            <div id="form-email" class="form-group">
                <label data-i18n="email_address">Email Address</label><input type="email" id="emailTo" placeholder="recipient@example.com" oninput="updateQR()">
                <div style="margin-top:15px"><label data-i18n="subject">Subject</label><input type="text" id="emailSub" placeholder="Inquiry" oninput="updateQR()"></div>
                <div style="margin-top:15px"><label data-i18n="body">Body</label><textarea id="emailBody" placeholder="Message content..." oninput="updateQR()"></textarea></div>
            </div>

            <div id="form-phone" class="form-group"><label data-i18n="phone_number">Phone Number</label><input type="tel" id="telInput" placeholder="+1 555 123 4567" oninput="updateQR()"></div>

            <div id="form-sms" class="form-group">
                <label data-i18n="phone_number">Phone Number</label><input type="tel" id="smsPhone" placeholder="+1 555 123 4567" oninput="updateQR()">
                <div style="margin-top:15px"><label data-i18n="message">Message</label><textarea id="smsBody" placeholder="I'm interested in..." oninput="updateQR()"></textarea></div>
            </div>

            <div id="form-geo" class="form-group">
                <div class="row-2"><div><label data-i18n="latitude">Latitude</label><input type="text" id="geoLat" placeholder="40.7128" oninput="updateQR()"></div><div><label data-i18n="longitude">Longitude</label><input type="text" id="geoLong" placeholder="-74.0060" oninput="updateQR()"></div></div>
            </div>

            <div id="form-vcard" class="form-group">
                <label data-i18n="full_name">Full Name</label><input type="text" id="vName" placeholder="John Doe" oninput="updateQR()">
                <div class="row-2" style="margin-top:15px"><div><label data-i18n="phone">Phone</label><input type="text" id="vPhone" placeholder="+1 555..." oninput="updateQR()"></div><div><label data-i18n="email">Email</label><input type="email" id="vEmail" placeholder="john@..." oninput="updateQR()"></div></div>
            </div>

            <div id="form-text" class="form-group"><label data-i18n="plain_text">Plain Text</label><textarea id="textInput" placeholder="Type your message..." oninput="updateQR()"></textarea></div>

            <!-- Customization Section -->
            <div class="design-section">
                <button class="design-toggle" onclick="toggleDesign()">
                    <span style="display:flex; align-items:center; gap:10px;">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="12" cy="12" r="10"/><path d="M14.31 8l5.74 9.94M9.69 8h11.48M7.38 12l5.74-9.94M9.69 16L3.95 6.06M14.31 16H2.83M16.62 12l-5.74 9.94"/></svg>
                        <span data-i18n="design_colors">Design & Colors</span>
                    </span>
                    <span id="designToggleText" class="toggle-text-btn">Show Details</span>
                </button>

                <div class="design-options-wrapper" id="designWrapper">
                    <div class="design-options-inner">
                        <div style="margin-bottom: 1.5rem;">
                            <label style="margin-bottom:0.8rem" data-i18n="color_theme">Color Theme</label>
                            <div class="color-bubbles-container">
                                <div class="color-bubble active" style="background: linear-gradient(135deg, #6366f1, #a855f7)" onclick="setTheme(this, '#6366f1', '#a855f7')"></div>
                                <div class="color-bubble" style="background: linear-gradient(135deg, #3b82f6, #06b6d4)" onclick="setTheme(this, '#3b82f6', '#06b6d4')"></div>
                                <div class="color-bubble" style="background: linear-gradient(135deg, #f43f5e, #f97316)" onclick="setTheme(this, '#f43f5e', '#f97316')"></div>
                                <div class="color-bubble" style="background: linear-gradient(135deg, #10b981, #3b82f6)" onclick="setTheme(this, '#10b981', '#3b82f6')"></div>
                                <div class="color-bubble" style="background: #1e293b" onclick="setTheme(this, '#1e293b', '#1e293b')"></div>
                                <div class="color-bubble" style="background: #000000" onclick="setTheme(this, '#000000', '#000000')"></div>
                                
                                <div class="custom-picker-wrapper" title="Custom Color">
                                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
                                        <line x1="12" y1="5" x2="12" y2="19"></line>
                                        <line x1="5" y1="12" x2="19" y2="12"></line>
                                    </svg>
                                    <input type="color" id="customColor1" class="custom-picker-input" onchange="applyCustomColor()">
                                </div>
                            </div>
                        </div>

                        <div class="design-grid">
                            <div>
                                <label data-i18n="dot_style">Dot Style</label>
                                <select id="dotStyle" onchange="updateQR()">
                                    <option value="rounded">Rounded</option>
                                    <option value="dots">Dots</option>
                                    <option value="classy">Classy</option>
                                    <option value="square">Square</option>
                                    <option value="extra-rounded">Extra Smooth</option>
                                </select>
                            </div>
                            <div>
                                <label data-i18n="corners">Corners</label>
                                <select id="cornerStyle" onchange="updateQR()">
                                    <option value="extra-rounded">Smooth</option>
                                    <option value="dot">Dot</option>
                                    <option value="square">Square</option>
                                </select>
                            </div>
                            <div class="full-width">
                                <label data-i18n="branding_logo">Branding Logo</label>
                                <div class="file-upload" onclick="document.getElementById('logoInput').click()">
                                    <span id="logoFileName" data-i18n="drop_logo">Drop your logo here or click to browse</span>
                                    <input type="file" id="logoInput" hidden accept="image/*" onchange="handleLogo(this)">
                                </div>
                                <button id="removeLogoBtn" class="btn-remove-logo" onclick="removeLogo()" data-i18n="remove_logo">
                                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>
                                    Remove Logo
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Right: Preview -->
        <div class="preview-panel">
            <div class="preview-bg-pattern"></div>
            
            <!-- FEATURE 3: Scannability Score Widget -->
            <div class="scannability-widget" id="healthWidget">
                <div class="score-circle" id="scoreCircle" style="background:#10b981;">A+</div>
                <div class="score-info">
                    <span class="score-title" data-i18n="scannability_score_title">Scannability Score</span>
                    <span class="score-val" id="scoreValue">98% / Excellent</span>
                </div>
                <div class="score-dot" id="scoreDot" style="background:#10b981;"></div>
            </div>

            <!-- 1. STATIC PREVIEW (Default View) -->
            <div id="static-preview-container">
                <div id="qr-canvas"></div>
                
                <!-- FEATURE 4: Premium Buttons (No Icons) -->
                <div class="btn-group">
                    <button id="dlBtn" class="premium-btn btn-primary-pro" onclick="openModal()" data-i18n="download_qr">DOWNLOAD QR CODE</button>
                    <button class="premium-btn btn-secondary-pro" onclick="toggleSimulator(true)" data-i18n="simulate_scan">SIMULATE SCAN</button>
                </div>
            </div>

            <!-- 2. ANIMATED SIMULATOR (Hidden by default) -->
            <div id="anim-preview-container">
                <div class="iphone-frame" id="iphone">
                    <div class="dynamic-island" id="island"></div>
                    <div class="camera-screen">
                        <div class="status-bar">
                            <span>9:41</span>
                            <svg width="18" height="14" fill="currentColor" viewBox="0 0 16 16"><path d="M12.5 4a.5.5 0 0 1 .5.5v2h2a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-.5.5h-2v2a.5.5 0 0 1-1 0v-2h-2a.5.5 0 0 1-.5-.5v-2a.5.5 0 0 1 .5-.5h2v-2a.5.5 0 0 1 .5-.5z"/><path d="M1 4a1 1 0 0 1 1-1h12a1 1 0 0 1 1 1v8a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V4zm1 0v8h12V4H2z"/></svg>
                        </div>
                        <div class="viewfinder-area">
                            <div class="camera-bg"></div>
                            <!-- Dynamic QR Target -->
                            <div class="qr-target" id="qr-target">
                                <img id="qr-img-anim" src="" alt="Scan Target">
                            </div>
                            <div class="focus-corners">
                                <div class="corner tl"></div><div class="corner tr"></div>
                                <div class="corner bl"></div><div class="corner br"></div>
                            </div>
                            <div class="scan-beam"></div>
                        </div>
                        <div style="height: 80px; background: #000; display:flex; justify-content:center; align-items:center;">
                            <div style="width: 50px; height: 50px; border-radius: 50%; border: 3px solid white;"></div>
                        </div>
                        <!-- Bottom Sheet Result -->
                        <div class="bottom-sheet" id="sheet">
                            <div class="sheet-pill"></div>
                            <div id="sheet-content" style="width:100%"></div>
                            <div class="sheet-actions" id="sheet-actions"></div>
                        </div>
                    </div>
                </div>
                <button class="btn-close-sim" onclick="toggleSimulator(false)" data-i18n="close_simulator">Close Simulator</button>
            </div>
        </div>
    </div>

    <footer class="footer-text" data-i18n="copyright">© 2026 QR express. All rights reserved.</footer>

    <!-- MODAL -->
    <div id="downloadModal" class="modal-overlay" onclick="closeModalOutside(event)">
        <div class="modal-content">
            <button class="modal-close-icon" onclick="closeModal()">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
            </button>
            
            <div class="modal-header">
                <h3 class="modal-title" data-i18n="download_options">Download Options</h3>
                <p class="modal-subtitle" data-i18n="preview_design">Preview your design and select a format.</p>
            </div>
            
            <div class="modal-layout">
                <!-- Left Column: Canvas -->
                <div class="modal-preview-container">
                    <canvas id="previewCanvas"></canvas>
                </div>

                <!-- Right Column: Settings -->
                <div class="modal-controls">
                    <div>
                        <label data-i18n="frame_style">Frame Style</label>
                        <div class="template-grid">
                            <div class="template-card selected" onclick="selectTemplate(this, 'none')">
                                <div class="template-preview-icon tp-plain"></div>
                                <div class="template-name" data-i18n="plain">Plain</div>
                            </div>
                            <div class="template-card" onclick="selectTemplate(this, 'scan')">
                                <div class="template-preview-icon tp-scan"></div>
                                <div class="template-name" data-i18n="scan_me">Scan Me</div>
                            </div>
                            <div class="template-card" onclick="selectTemplate(this, 'wifi')">
                                <div class="template-preview-icon tp-wifi"></div>
                                <div class="template-name" data-i18n="restaurant_wifi">Rest. WiFi</div>
                            </div>
                            <div class="template-card" onclick="selectTemplate(this, 'portfolio')">
                                <div class="template-preview-icon tp-biz"></div>
                                <div class="template-name" data-i18n="portfolio">Portfolio</div>
                            </div>
                            <div class="template-card" onclick="selectTemplate(this, 'contact')">
                                <div class="template-preview-icon tp-biz"></div>
                                <div class="template-name" data-i18n="contact">Contact</div>
                            </div>
                            <div class="template-card" onclick="selectTemplate(this, 'sms')">
                                <div class="template-preview-icon tp-sms"></div>
                                <div class="template-name" data-i18n="feedback">Feedback</div>
                            </div>
                            <div class="template-card" onclick="selectTemplate(this, 'social')">
                                <div class="template-preview-icon tp-social"></div>
                                <div class="template-name" data-i18n="social_media">Social Media</div>
                            </div>
                            <div class="template-card" onclick="selectTemplate(this, 'product')">
                                <div class="template-preview-icon tp-product"></div>
                                <div class="template-name" data-i18n="product_info">Product Info</div>
                            </div>
                            <div class="template-card" onclick="selectTemplate(this, 'event')">
                                <div class="template-preview-icon tp-event"></div>
                                <div class="template-name" data-i18n="event">Event</div>
                            </div>
                        </div>
                    </div>

                    <div>
                        <label data-i18n="resolution">Resolution</label>
                        <select id="modalSizeSelect" onchange="updateModalPreview()">
                            <option value="500" data-i18n="px_500_web">500px (Web)</option>
                            <option value="1000" selected data-i18n="px_1000_print">1000px (Print)</option>
                            <option value="2000" data-i18n="px_2000_hq">2000px (High Quality)</option>
                        </select>
                    </div>

                    <button class="btn-confirm" id="confirmDlBtn" onclick="confirmDownload()" data-i18n="download_png">
                        Download PNG
                    </button>
                    <!-- FEATURE 1: SVG Download Button -->
                    <button class="btn-svg" onclick="downloadSVG()" data-i18n="download_vector">
                        Download Vector (QR Only)
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let qrCode;
        let logoUrl = "";
        let currentType = 'link';
        let currentTemplate = 'none';
        
        // Active Color State
        let activeColor1 = "#6366f1";
        let activeColor2 = "#a855f7";
        
        // Animation State
        let animationTimeout;

        // Clean Solid Icons for Simulator
        const icons = {
            web: '<svg fill="currentColor" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z"/></svg>',
            wifi: '<svg fill="currentColor" viewBox="0 0 24 24"><path d="M1 9l2 2c4.97-4.97 13.03-4.97 18 0l2-2C16.93 2.93 7.08 2.93 1 9zm8 8l3 3 3-3a4.237 4.237 0 0 0-6 0zm-4-4l2 2a7.074 7.074 0 0 1 10 0l2-2C15.14 9.14 8.87 9.14 5 13z"/></svg>',
            mail: '<svg fill="currentColor" viewBox="0 0 24 24"><path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/></svg>',
            sms: '<svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2z"/></svg>',
            phone: '<svg fill="currentColor" viewBox="0 0 24 24"><path d="M6.62 10.79c1.44 2.83 3.76 5.14 6.59 6.59l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.57.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1-9.39 0-17-7.61-17-17 0-.55.45-1 1-1h3.5c.55 0 1 .45 1 1 0 1.25.2 2.45.57 3.57.11.35.03.74-.25 1.02l-2.2 2.2z"/></svg>',
            map: '<svg fill="currentColor" viewBox="0 0 24 24"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/></svg>',
            contact: '<svg fill="currentColor" viewBox="0 0 24 24"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg>',
            text: '<svg fill="currentColor" viewBox="0 0 24 24"><path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z"/></svg>'
        };

        function initQR() {
            qrCode = new QRCodeStyling({
                width: 300,
                height: 300,
                type: "svg",
                data: "https://example.com",
                image: "",
                dotsOptions: { color: "#6366f1", type: "rounded" },
                backgroundOptions: { color: "#ffffff" },
                imageOptions: { crossOrigin: "anonymous", margin: 10 }
            });
            qrCode.append(document.getElementById("qr-canvas"));
            updateQR();
        }

        function getData() {
            if (currentType === 'link') return document.getElementById('urlInput').value || "https://example.com";
            if (currentType === 'wifi') {
                const ssid = document.getElementById('ssidInput').value;
                const pass = document.getElementById('passInput').value;
                const enc = document.getElementById('encInput').value;
                return `WIFI:T:${enc};S:${ssid};P:${pass};;`;
            }
            if (currentType === 'email') {
                const to = document.getElementById('emailTo').value || "recipient@example.com";
                const sub = encodeURIComponent(document.getElementById('emailSub').value);
                const body = encodeURIComponent(document.getElementById('emailBody').value);
                return `mailto:${to}?subject=${sub}&body=${body}`;
            }
            if (currentType === 'phone') return `tel:${document.getElementById('telInput').value || "+15551234567"}`;
            if (currentType === 'sms') {
                const phone = document.getElementById('smsPhone').value || "+15551234567";
                const msg = document.getElementById('smsBody').value || "";
                return `smsto:${phone}:${msg}`;
            }
            if (currentType === 'geo') {
                const lat = document.getElementById('geoLat').value || "0";
                const long = document.getElementById('geoLong').value || "0";
                return `geo:${lat},${long}`;
            }
            if (currentType === 'vcard') {
                const n = document.getElementById('vName').value;
                const p = document.getElementById('vPhone').value;
                const e = document.getElementById('vEmail').value;
                return `BEGIN:VCARD\nVERSION:3.0\nN:${n}\nTEL:${p}\nEMAIL:${e}\nEND:VCARD`;
            }
            if (currentType === 'text') return document.getElementById('textInput').value || "Welcome";
        }

        function setTheme(element, c1, c2) {
            activeColor1 = c1;
            activeColor2 = c2;
            document.documentElement.style.setProperty('--primary', c1);
            document.querySelectorAll('.color-bubble').forEach(el => el.classList.remove('active'));
            element.classList.add('active');
            updateQR();
        }

        function applyCustomColor() {
            const picker = document.getElementById('customColor1');
            activeColor1 = picker.value;
            activeColor2 = picker.value;
            document.documentElement.style.setProperty('--primary', activeColor1);
            document.querySelectorAll('.color-bubble').forEach(el => el.classList.remove('active'));
            updateQR();
        }

        function updateQR() {
            const data = getData();
            const dotStyle = document.getElementById('dotStyle').value;
            const cornerStyle = document.getElementById('cornerStyle').value;

            qrCode.update({
                data: data,
                image: logoUrl,
                backgroundOptions: { color: "#ffffff" },
                dotsOptions: {
                    type: dotStyle,
                    gradient: {
                        type: "linear",
                        rotation: 45,
                        colorStops: [{ offset: 0, color: activeColor1 }, { offset: 1, color: activeColor2 }]
                    }
                },
                cornersSquareOptions: { type: cornerStyle, color: activeColor1 },
                cornersDotOptions: { type: cornerStyle, color: activeColor1 }
            });

            // Trigger Pulse Animation
            const canvasContainer = document.getElementById('qr-canvas');
            canvasContainer.classList.remove('canvas-pulse');
            void canvasContainer.offsetWidth; 
            canvasContainer.classList.add('canvas-pulse');

            // FEATURE 3: Check Scannability
            calculateScannability(data);
        }

        // FEATURE 3: Scannability Logic
        function calculateScannability(data) {
            let score = 100;
            let deductions = [];
            
            // 1. Check Data Density (Length)
            if (data.length > 100) { score -= 10; deductions.push("High Density"); }
            if (data.length > 200) { score -= 15; deductions.push("Very High Density"); }

            // 2. Check Logo (Estimated obstruction)
            if (logoUrl) { score -= 5; } // Logo always adds risk

            // 3. Contrast Check (Simplified approximation based on current theme)
            // Convert activeColor1 to RGB and check against white background
            const rgb = hexToRgb(activeColor1);
            const luminance = (0.299 * rgb.r + 0.587 * rgb.g + 0.114 * rgb.b);
            
            if (luminance > 200) {
                // Light color on white background -> Bad Contrast
                score -= 30; deductions.push("Low Contrast");
            }

            // Update Widget
            const scoreVal = document.getElementById('scoreValue');
            const scoreCircle = document.getElementById('scoreCircle');
            const scoreDot = document.getElementById('scoreDot');
            
            let color = '#10b981'; // Green
            let grade = 'A+';
            let text = 'Excellent';

            if (score < 90) { color = '#facc15'; grade = 'B'; text = 'Good'; }
            if (score < 70) { color = '#fb923c'; grade = 'C'; text = 'Risky'; }
            if (score < 50) { color = '#ef4444'; grade = 'D'; text = 'Unscannable'; }

            scoreVal.innerText = `${score}% / ${text}`;
            scoreCircle.innerText = grade;
            scoreCircle.style.background = color;
            scoreDot.style.background = color;
        }

        function hexToRgb(hex) {
            // Expand shorthand form (e.g. "03F") to full form (e.g. "0033FF")
            var shorthandRegex = /^#?([a-f\d])([a-f\d])([a-f\d])$/i;
            hex = hex.replace(shorthandRegex, function(m, r, g, b) {
                return r + r + g + g + b + b;
            });
            var result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
            return result ? {
                r: parseInt(result[1], 16),
                g: parseInt(result[2], 16),
                b: parseInt(result[3], 16)
            } : { r: 0, g: 0, b: 0 };
        }

        function switchTab(type) {
            currentType = type;
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            event.currentTarget.classList.add('active'); 
            document.querySelectorAll('.form-group').forEach(f => f.classList.remove('active'));
            document.getElementById(`form-${type}`).classList.add('active');
            updateQR();
        }

        function handleLogo(input) {
            const file = input.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    logoUrl = e.target.result;
                    document.getElementById('logoFileName').innerText = file.name;
                    document.getElementById('removeLogoBtn').style.display = 'flex';
                    updateQR();
                };
                reader.readAsDataURL(file);
            }
        }

        function removeLogo() {
            logoUrl = "";
            document.getElementById('logoInput').value = ""; // Clear input
            document.getElementById('logoFileName').innerText = (i18n && i18n.t ? i18n.t('drop_logo') : "Drop your logo here or click to browse");
            document.getElementById('removeLogoBtn').style.display = 'none';
            updateQR();
        }

        function toggleDesign() {
            const wrapper = document.getElementById('designWrapper');
            const toggleText = document.getElementById('designToggleText');
            wrapper.classList.toggle('open');
            toggleText.innerText = wrapper.classList.contains('open') ? (i18n && i18n.t ? i18n.t('hide_details') : 'Hide Details') : (i18n && i18n.t ? i18n.t('show_details') : 'Show Details');
        }

        function toggleLangMenu(e) {
            e.stopPropagation(); 
            document.getElementById('langMenu').classList.toggle('show');
        }

        function selectLang(countryCode, label) {
            document.getElementById('currentFlag').src = `https://flagcdn.com/w40/${countryCode}.png`;
            document.getElementById('currentCode').innerText = label;
            document.getElementById('langMenu').classList.remove('show');
            
            // Map country code to language code and switch
            const langMap = {
                'gb': 'en',
                'ro': 'ro',
                'it': 'it',
                'ru': 'ru',
                'ua': 'uk'
            };
            
            const newLang = langMap[countryCode] || 'en';
            
            // Use hash-based routing - no page reload!
            if (window.i18n) {
                window.i18n.switchLanguage(newLang);
            } else {
                window.location.hash = `#${newLang}`;
            }
        }

        window.onclick = function(event) {
            if (!event.target.closest('.lang-dropdown')) {
                document.getElementById('langMenu').classList.remove('show');
            }
        }

        /* --- SIMULATION LOGIC --- */
        async function toggleSimulator(show) {
            const staticView = document.getElementById('static-preview-container');
            const animView = document.getElementById('anim-preview-container');
            const animImg = document.getElementById('qr-img-anim');

            if(show) {
                const blob = await qrCode.getRawData('png');
                animImg.src = URL.createObjectURL(blob);
                staticView.style.display = 'none';
                animView.style.display = 'flex';
                startScanCycle();
            } else {
                clearTimeout(animationTimeout);
                document.getElementById('iphone').classList.remove('scanning');
                document.getElementById('sheet').classList.remove('visible');
                document.getElementById('island').classList.remove('show-success');
                animView.style.display = 'none';
                staticView.style.display = 'flex';
            }
        }

        function startScanCycle() {
            const iphone = document.getElementById('iphone');
            const sheet = document.getElementById('sheet');
            const island = document.getElementById('island');

            iphone.classList.remove('scanning');
            sheet.classList.remove('visible');
            island.classList.remove('show-success');

            animationTimeout = setTimeout(() => {
                iphone.classList.add('scanning'); 

                animationTimeout = setTimeout(() => {
                    iphone.classList.remove('scanning');
                    showSimulatedResult(); 

                    animationTimeout = setTimeout(() => {
                        sheet.classList.remove('visible');
                        island.classList.remove('show-success');
                        animationTimeout = setTimeout(startScanCycle, 1000);
                    }, 4000); 

                }, 2000); 

            }, 500); 
        }

        function showSimulatedResult() {
            const contentDiv = document.getElementById('sheet-content');
            const actionsDiv = document.getElementById('sheet-actions');
            let html = '';
            let buttonsHtml = '';

            if(currentType === 'link') {
                const url = document.getElementById('urlInput').value || "example.com";
                html = `<div class="sheet-icon">${icons.web}</div><div class="sheet-desc" style="font-weight:700; color:#000; font-size:16px">${url}</div>`;
                buttonsHtml = `<button class="ios-action-btn primary">${i18n && i18n.t ? i18n.t('open_in_safari') : 'Open in Safari'}</button><button class="ios-action-btn secondary">${i18n && i18n.t ? i18n.t('copy_link') : 'Copy Link'}</button>`;
            } 
            else if(currentType === 'wifi') {
                const ssid = document.getElementById('ssidInput').value || "Network";
                html = `<div class="sheet-icon">${icons.wifi}</div><div class="sheet-desc">Join Wi-Fi Network <strong>"${ssid}"</strong>?</div>`;
                buttonsHtml = `<button class="ios-action-btn primary">${i18n && i18n.t ? i18n.t('join_network') : 'Join Network'}</button><button class="ios-action-btn secondary">${i18n && i18n.t ? i18n.t('share_password') : 'Share Password'}</button>`;
            } 
            else if(currentType === 'email') {
                const mail = document.getElementById('emailTo').value || "email@example.com";
                html = `<div class="sheet-icon">${icons.mail}</div><div class="sheet-desc">Compose email to <strong>${mail}</strong></div>`;
                buttonsHtml = `<button class="ios-action-btn primary">${i18n && i18n.t ? i18n.t('open_mail') : 'Open Mail'}</button>`;
            } 
            else if(currentType === 'sms') {
                const sms = document.getElementById('smsPhone').value || "123-456";
                html = `<div class="sheet-icon">${icons.sms}</div><div class="sheet-desc">Text Message to <strong>${sms}</strong></div>`;
                buttonsHtml = `<button class="ios-action-btn primary">${i18n && i18n.t ? i18n.t('open_messages') : 'Open Messages'}</button>`;
            }
            else if(currentType === 'phone') {
                const ph = document.getElementById('telInput').value || "555-0123";
                html = `<div class="sheet-icon">${icons.phone}</div><div class="sheet-desc">Call <strong>${ph}</strong>?</div>`;
                buttonsHtml = `<button class="ios-action-btn primary">${i18n && i18n.t ? i18n.t('call') : 'Call'}</button>`;
            }
            else if(currentType === 'geo') {
                html = `<div class="sheet-icon">${icons.map}</div><div class="sheet-desc">View Location in Maps</div>`;
                buttonsHtml = `<button class="ios-action-btn primary">${i18n && i18n.t ? i18n.t('open_maps') : 'Open Maps'}</button>`;
            }
            else if(currentType === 'vcard') {
                const name = document.getElementById('vName').value || "Contact";
                html = `<div class="sheet-icon">${icons.contact}</div><div class="sheet-desc">Add <strong>${name}</strong> to Contacts</div>`;
                buttonsHtml = `<button class="ios-action-btn primary">${i18n && i18n.t ? i18n.t('save_contact') : 'Save Contact'}</button>`;
            }
            else {
                html = `<div class="sheet-icon">${icons.text}</div><div class="sheet-desc">Plain Text detected.</div>`;
                buttonsHtml = `<button class="ios-action-btn primary">${i18n && i18n.t ? i18n.t('search_web') : 'Search Web'}</button><button class="ios-action-btn secondary">${i18n && i18n.t ? i18n.t('copy') : 'Copy'}</button>`;
            }

            contentDiv.innerHTML = html;
            actionsDiv.innerHTML = buttonsHtml;
            
            document.getElementById('sheet').classList.add('visible');
            document.getElementById('island').classList.add('show-success');
        }

        /* --- MODAL LOGIC --- */
        function openModal() {
            const modal = document.getElementById('downloadModal');
            modal.style.display = 'flex';
            setTimeout(() => modal.classList.add('show'), 10);
            updateModalPreview(); 
        }

        function closeModal() {
            const modal = document.getElementById('downloadModal');
            modal.classList.remove('show');
            setTimeout(() => modal.style.display = 'none', 300);
        }

        function closeModalOutside(e) {
            if (e.target === document.getElementById('downloadModal')) closeModal();
        }

        function selectTemplate(el, type) {
            currentTemplate = type;
            document.querySelectorAll('.template-card').forEach(c => c.classList.remove('selected'));
            el.classList.add('selected');
            updateModalPreview();
        }

        async function drawCanvas(targetCanvas, outputSize) {
            const ctx = targetCanvas.getContext('2d');
            
            qrCode.update({ width: outputSize, height: outputSize });
            const blob = await qrCode.getRawData("png");
            const img = await createImageBitmap(blob);

            let padding = 0;
            let bottomTextHeight = 0;
            let frameText = "";
            let frameColor = activeColor1; 

            // Configure Template Logic
            if (currentTemplate !== 'none') {
                padding = outputSize * 0.1; 
                bottomTextHeight = outputSize * 0.15;
                
                if (currentTemplate === 'scan') frameText = (i18n && i18n.t ? i18n.t('scan_me_text') : "SCAN ME");
                else if (currentTemplate === 'wifi') frameText = (i18n && i18n.t ? i18n.t('connect_wifi_text') : "Connect to WiFi");
                else if (currentTemplate === 'portfolio') frameText = (i18n && i18n.t ? i18n.t('view_portfolio_text') : "View Portfolio");
                else if (currentTemplate === 'contact') frameText = (i18n && i18n.t ? i18n.t('save_contact_text') : "Save Contact");
                else if (currentTemplate === 'sms') frameText = (i18n && i18n.t ? i18n.t('send_feedback_text') : "Send Feedback");
                else if (currentTemplate === 'social') { frameText = (i18n && i18n.t ? i18n.t('connect_with_us_text') : "Connect With Us"); frameColor = "#8b5cf6"; }
                else if (currentTemplate === 'product') { frameText = (i18n && i18n.t ? i18n.t('product_details_text') : "Product Details"); frameColor = "#3b82f6"; }
                else if (currentTemplate === 'event') { frameText = (i18n && i18n.t ? i18n.t('event_checkin_text') : "Event Check-In"); frameColor = "#f97316"; }
            }

            const finalWidth = outputSize + (padding * 2);
            const finalHeight = outputSize + (padding * 2) + (frameText ? bottomTextHeight : 0);
            
            targetCanvas.width = finalWidth;
            targetCanvas.height = finalHeight;

            ctx.fillStyle = "#ffffff";
            ctx.fillRect(0, 0, finalWidth, finalHeight);

            if (currentTemplate !== 'none') {
                ctx.lineWidth = outputSize * 0.01; 
                ctx.strokeStyle = frameColor;
                
                if (currentTemplate === 'scan') {
                    ctx.fillStyle = "#1e293b"; 
                    ctx.fillRect(0, finalHeight - bottomTextHeight, finalWidth, bottomTextHeight);
                    ctx.fillStyle = "#ffffff";
                } 
                else if (currentTemplate === 'sms') {
                    ctx.setLineDash([20, 10]);
                    ctx.strokeRect(padding/2, padding/2, finalWidth - padding, finalHeight - padding);
                    ctx.setLineDash([]);
                    ctx.fillStyle = "#ef4444";
                }
                else {
                    ctx.strokeRect(padding/2, padding/2, finalWidth - padding, finalHeight - padding);
                    ctx.fillStyle = frameColor;
                }

                ctx.font = `800 ${outputSize * 0.07}px 'Plus Jakarta Sans', sans-serif`;
                ctx.textAlign = "center";
                ctx.textBaseline = "middle";
                
                let textY = finalHeight - (bottomTextHeight / 2);
                if(currentTemplate !== 'scan') {
                    textY = finalHeight - (bottomTextHeight / 1.5);
                }
                ctx.fillText(frameText.toUpperCase(), finalWidth / 2, textY);
            }

            ctx.drawImage(img, padding, padding, outputSize, outputSize);
            qrCode.update({ width: 300, height: 300 });
        }

        async function updateModalPreview() {
            const previewCanvas = document.getElementById('previewCanvas');
            await drawCanvas(previewCanvas, 300);
        }

        async function confirmDownload() {
            const btn = document.getElementById('confirmDlBtn');
            const originalText = btn.innerHTML;
            const size = parseInt(document.getElementById('modalSizeSelect').value);
            
            btn.disabled = true;
            btn.innerHTML = (i18n && i18n.t ? i18n.t('processing') : 'Processing...');

            const tempCanvas = document.createElement('canvas');
            await drawCanvas(tempCanvas, size);

            const link = document.createElement('a');
            link.download = `QRExpress-${currentType}-${Date.now()}.png`;
            link.href = tempCanvas.toDataURL("image/png");
            link.click();

            btn.disabled = false;
            btn.innerHTML = (i18n && i18n.t ? i18n.t('downloaded') : 'Downloaded!');
            setTimeout(() => {
                btn.innerHTML = originalText;
                closeModal();
            }, 1000);
        }

        // FEATURE 1: Download SVG Logic
        async function downloadSVG() {
            // We get the raw SVG data from the library
            // Note: This downloads the QR Code Vector Only (without the canvas frame/background)
            // This is preferred by professional designers.
            const blob = await qrCode.getRawData('svg');
            const link = document.createElement('a');
            link.download = `QRExpress-Vector-${Date.now()}.svg`;
            link.href = URL.createObjectURL(blob);
            link.click();
        }

        window.onload = initQR;
    </script>
</body>
</html>